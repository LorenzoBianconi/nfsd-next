# SPDX-License-Identifier: ((GPL-2.0 WITH Linux-syscall-note) OR BSD-3-Clause)

name: nfsd
protocol: genetlink
uapi-header: linux/nfsd_netlink.h

doc: NFSD configuration over generic netlink.

attribute-sets:
  -
    name: rpc-status
    attributes:
      -
        name: xid
        type: u32
        byte-order: big-endian
      -
        name: flags
        type: u32
      -
        name: prog
        type: u32
      -
        name: version
        type: u8
      -
        name: proc
        type: u32
      -
        name: service_time
        type: s64
      -
        name: pad
        type: pad
      -
        name: saddr4
        type: u32
        byte-order: big-endian
        display-hint: ipv4
      -
        name: daddr4
        type: u32
        byte-order: big-endian
        display-hint: ipv4
      -
        name: saddr6
        type: binary
        display-hint: ipv6
      -
        name: daddr6
        type: binary
        display-hint: ipv6
      -
        name: sport
        type: u16
        byte-order: big-endian
      -
        name: dport
        type: u16
        byte-order: big-endian
      -
        name: compound-ops
        type: u32
        multi-attr: true
  -
    name: control-plane
    attributes:
      -
        name: threads
        type: u32
      -
        name: max-blksize
        type: u32
      -
        name: max-conn
        type: u32

operations:
  list:
    -
      name: rpc-status-get
      doc: dump pending nfsd rpc
      attribute-set: rpc-status
      dump:
        pre: nfsd-nl-rpc-status-get-start
        post: nfsd-nl-rpc-status-get-done
    -
      name: threads-set
      doc: set the number of running threads
      attribute-set: control-plane
      flags: [ admin-perm ]
      do:
        request:
          attributes:
            - threads
    -
      name: threads-get
      doc: dump the number of running threads
      attribute-set: control-plane
      dump:
        reply:
          attributes:
            - threads
    -
      name: max-blksize-set
      doc: set the nfs block size
      attribute-set: control-plane
      flags: [ admin-perm ]
      do:
        request:
          attributes:
            - max-blksize
    -
      name: max-blksize-get
      doc: dump the nfs block size
      attribute-set: control-plane
      dump:
        reply:
          attributes:
            - max-blksize
    -
      name: max-conn-set
      doc: set the max number of connections
      attribute-set: control-plane
      flags: [ admin-perm ]
      do:
        request:
          attributes:
            - max-conn
    -
      name: max-conn-get
      doc: dump the max number of connections
      attribute-set: control-plane
      dump:
        reply:
          attributes:
            - max-conn
